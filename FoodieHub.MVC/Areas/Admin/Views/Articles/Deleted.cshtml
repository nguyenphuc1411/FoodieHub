@using FoodieHub.MVC.Models.Response
@using System.Text.Json
@inject IConfiguration config
@{
    ViewData["Title"] = "Deleted Articles";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
    var url = config["BaseHost"];
}
@model PaginatedModel<JsonElement>

<div class="container py-4">
    <!-- Header Section -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-danger">Deleted Articles</h2>
        <!-- Back to List Button -->
        <a asp-action="Index" class="btn btn-secondary">Back to Articles</a>
    </div>

    <!-- Total Count of Deleted Articles -->
    <div class="mb-3">
        <strong>Total Deleted Articles: </strong>@(Model != null ? Model.TotalItems : 0)
    </div>

    <!-- Table Section -->
    <div class="table-responsive">
        <table class="table table-bordered text-center align-middle">
            <thead class="table-light">
                <tr>
                    <th>ArticleID</th>
                    <th>Title</th>
                    <th>Main Image</th>
                    <th>Author</th>
                    <th>Category</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Items != null)
                {
                    foreach (var item in Model.Items)
                    {
                        var articleId = item.GetProperty("articleID").GetInt32();
                        <tr>
                            <td>@articleId</td>
                            <td>@item.GetProperty("title").ToString()</td>
                            <td>
                                @if (item.TryGetProperty("mainImage", out JsonElement mainImageElement))
                                {
                                    <img src="@($"{url}/images/{mainImageElement.GetString()}")" alt="Article Image" class="img-thumbnail" style="width:50px;height:50px" />
                                }
                                else
                                {
                                    <span class="text-danger">N/A</span>
                                }
                            </td>
                            <td>@item.GetProperty("fullname").ToString()</td>
                            <td>@item.GetProperty("categoryName").ToString()</td>
                            <td>
                                <!-- Nút khôi phục bài viết -->
                                <a asp-controller="Articles" asp-action="Restore" asp-route-id="@articleId" class="btn btn-info btn-sm">Restore</a>
                                <!-- Button to trigger the modal -->                     
                                <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="@("#model" + articleId)">Delete Permanently</button>

                                <!-- Confirmation Modal -->
                                <div class="modal fade" id="@("model"+articleId)" tabindex="-1" aria-labelledby="confirmDeleteModalLabel@articleId" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel">Confirm Deletion</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                Are you sure you want to delete the article with ID: @articleId? <br />
                                                This action will permanently delete the article and all associated favorites and comments.
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                <a href="@Url.Action("PermanentDelete", "Articles", new { id = articleId })" class="btn btn-danger">Delete</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <form method="get" class="d-flex justify-content-between align-items-center mt-3">
        <!-- Select box for page size -->
        <div>
            <select name="pageSize" class="form-select form-select-sm" style="width: 70px;" onchange="this.form.submit()">
                @for (int i = 2; i <= 20; i += 2)
                {
                    if (Model.PageSize == i)
                    {
                        <option value="@i" selected>@i</option>
                    }
                    else
                    {
                        <option value="@i">@i</option>
                    }
                }
            </select>
        </div>

        <!-- Pagination navigation -->
        <nav aria-label="Page navigation example">
            <ul class="pagination pagination-sm mb-0">
                <li class="page-item @(Model.Page == 1 ? "disabled" : "")">
                    <a class="page-link" asp-route-pageSize="@Model.PageSize" asp-route-currentPage="@(Model.Page - 1)">Previous</a>
                </li>

                @for (int i = 1; i <= Model.TotalPages; i++)
                {
                    <li class="page-item @(i == Model.Page ? "active" : "")">
                        <a class="page-link" asp-route-pageSize="@Model.PageSize" asp-route-currentPage="@i">@i</a>
                    </li>
                }

                <li class="page-item @(Model.Page == Model.TotalPages ? "disabled" : "")">
                    <a class="page-link" asp-route-pageSize="@Model.PageSize" asp-route-currentPage="@(Model.Page + 1)">Next</a>
                </li>
            </ul>
        </nav>
    </form>

    <style>
        body {
            background-color: #f5f9ff;
        }

        h2 {
            color: #e74c3c;
        }

        .table-bordered th, .table-bordered td {
            vertical-align: middle;
        }

        .text-danger {
            color: #dc3545;
        }
    </style>
</div>
