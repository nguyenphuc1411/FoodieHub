@using FoodieHub.MVC.Models.Recipe
@using FoodieHub.MVC.Models.Categories
@using FoodieHub.MVC.Service.Interfaces
@inject IConfiguration config
@inject IRecipeCategoryService categoryService
@{
    ViewData["Title"] = "Edit Recipe";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var url = config["BaseHost"];
    var categories = await categoryService.GetAll() ?? new List<GetRecipeCategoryDTO>();
}

@model UpdateRecipeDTO
<div class="container-sm col-12 col-md-8 my-3">
    <h2 class="mb-4">Edit Recipe</h2>

    <form asp-action="UpdateRecipe" enctype="multipart/form-data" method="post">
        <input type="hidden" asp-for="RecipeID" />

        <!-- Recipe Information -->
        <div class="form-group">
            <label asp-for="Title" class="font-weight-bold">Recipe Title</label>
            <input asp-for="Title" class="form-control" placeholder="Enter the recipe title" />
            <span asp-validation-for="Title" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="Description" class="font-weight-bold">Description</label>
            <textarea asp-for="Description" class="form-control" placeholder="Enter the recipe description"></textarea>
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>
        <div class="row">
            <div class="form-group col-12 col-md-4">
                <label asp-for="CookTime" class="font-weight-bold">Cook Time</label>
                <input asp-for="CookTime" type="time" class="form-control" placeholder="Enter cook time" />
                <span asp-validation-for="CookTime" class="text-danger"></span>
            </div>

            <div class="form-group col-12 col-md-4">
                <label asp-for="Serves" class="font-weight-bold">Serves</label>
                <input asp-for="Serves" class="form-control" placeholder="Enter number of servings" />
                <span asp-validation-for="Serves" class="text-danger"></span>
            </div>

            <div class="form-group col-12 col-md-4">
                <label asp-for="CategoryID" class="font-weight-bold">Category</label>
                <select asp-for="CategoryID" asp-items="@(new SelectList(categories, "CategoryID", "CategoryName"))" class="form-control">
                    <option value="">Select Category</option>
                </select>
            </div>
        </div>
       
        <div class="row my-3">
            <div class="form-group col-12 col-md-6">
                <label asp-for="ImageURL" class="font-weight-bold">Current Image</label>
                <img src=@(url+"images/"+@Model.ImageURL) alt="Recipe Image" class="img-fluid" style="max-width: 100px;" />
            </div>
            <div class="form-group col-12 col-md-6">
                <label asp-for="File" class="font-weight-bold">Upload New Image</label>
                <input asp-for="File" type="file" class="form-control" accept="images/*" />
            </div>
        </div>
      

       

        <hr />

        <!-- Recipe Steps -->
        <h4 class="mb-3">Recipe Steps</h4>
        <table class="table" id="stepsTable">
            <thead>
                <tr>
                    <th style="width: 10%;" class="text-center">Step Number</th>
                    <th style="width: 60%;" class="text-center">Directions</th>
                    <th style="width: 20%;" class="text-center">Step Image</th>
                    <th style="width: 10%;" class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                @for (var i = 0; i < Model.RecipeSteps.Count; i++)
                {
                    <tr>
                        <td style="width: 10%;"><input asp-for="RecipeSteps[@i].Step" class="form-control" /></td>
                        <td style="width: 60%;"><textarea asp-for="RecipeSteps[@i].Directions" class="form-control"></textarea></td>
                        <td style="width: 20%;">
                            @if (!string.IsNullOrEmpty(Model.RecipeSteps[i].ImageURL))
                            {
                                <img src="@Model.RecipeSteps[i].ImageURL" alt="Step Image" class="img-fluid" style="max-width: 100px;" />
                            }
                            <input asp-for="RecipeSteps[@i].FileStep" type="file" class="form-control" />
                        </td>
                        <td style="width: 10%;">
                            <button type="button" class="btn btn-danger" onclick="removeStep(this)">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <button type="button" class="btn btn-primary" onclick="addStep()">Add Step</button>

        <hr />

        <!-- Ingredients -->
        <h4 class="mb-3">Ingredients</h4>
        <table class="table" id="ingredientsTable">
            <thead>
                <tr>
                    <th style="width: 50%;" class="text-center">Ingredient</th>
                    <th style="width: 20%;" class="text-center">Quantity</th>
                    <th style="width: 20%;" class="text-center">Unit</th>
                    <th style="width: 10%;" class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                @for (var i = 0; i < Model.Ingredients.Count; i++)
                {
                    <tr>
                        <td style="width: 50%;"><input asp-for="Ingredients[@i].Name" class="form-control" placeholder="Ingredient name" /></td>
                        <td style="width: 20%;"><input asp-for="Ingredients[@i].Quantity" class="form-control" placeholder="Quantity" /></td>
                        <td style="width: 20%;"><input asp-for="Ingredients[@i].Unit" class="form-control" placeholder="Unit" /></td>
                        <td style="width: 10%;">
                            <button type="button" class="btn btn-danger" onclick="removeIngredient(this)">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <button type="button" class="btn btn-primary" onclick="addIngredient()">Add Ingredient</button>

        <hr />

        <div class="form-group text-center">
            <button type="submit" class="button button-dark">Update</button>
        </div>
    </form>
</div>


@section Scripts {
    <script>
        function addStep() {
            var table = document.getElementById('stepsTable').getElementsByTagName('tbody')[0];
            var rowCount = table.rows.length;
            var row = table.insertRow(rowCount);

            row.innerHTML = `
                <td><input name="RecipeSteps[${rowCount}].Step" class="form-control" /></td>
                <td><textarea name="RecipeSteps[${rowCount}].Directions" class="form-control"></textarea></td>
                <td><input name="RecipeSteps[${rowCount}].FileStep" type="file" class="form-control" /></td>
                <td><button type="button" class="btn btn-danger" onclick="removeStep(this)">Delete</button></td>`;
        }

        function removeStep(button) {
            var row = button.closest('tr');
            row.parentNode.removeChild(row);
        }

        function addIngredient() {
            var table = document.getElementById('ingredientsTable').getElementsByTagName('tbody')[0];
            var rowCount = table.rows.length;
            var row = table.insertRow(rowCount);

            row.innerHTML = `
                <td><input name="Ingredients[${rowCount}].Name" class="form-control" /></td>
                <td><input name="Ingredients[${rowCount}].Quantity" class="form-control" /></td>
                <td><input name="Ingredients[${rowCount}].Unit" class="form-control" /></td>
                <td><button type="button" class="btn btn-danger" onclick="removeIngredient(this)">Delete</button></td>`;
        }

        function removeIngredient(button) {
            var row = button.closest('tr');
            row.parentNode.removeChild(row);
        }
    </script>
}
